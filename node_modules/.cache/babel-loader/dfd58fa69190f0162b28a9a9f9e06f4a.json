{"ast":null,"code":"// Copyright 2021 The Go Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style\n// license that can be found in the LICENSE file.\n\"use strict\";\n\nif (process.argv.length < 3) {\n  console.error(\"usage: go_js_wasm_exec [wasm binary] [arguments]\");\n  process.exit(1);\n}\n\nglobalThis.require = require;\nglobalThis.fs = require(\"fs\");\nglobalThis.TextEncoder = require(\"util\").TextEncoder;\nglobalThis.TextDecoder = require(\"util\").TextDecoder;\nglobalThis.performance = {\n  now() {\n    const [sec, nsec] = process.hrtime();\n    return sec * 1000 + nsec / 1000000;\n  }\n\n};\n\nconst crypto = require(\"crypto\");\n\nglobalThis.crypto = {\n  getRandomValues(b) {\n    crypto.randomFillSync(b);\n  }\n\n};\n\nrequire(\"./wasm_exec\");\n\nconst go = new Go();\ngo.argv = process.argv.slice(2);\ngo.env = Object.assign({\n  TMPDIR: require(\"os\").tmpdir()\n}, process.env);\ngo.exit = process.exit;\nWebAssembly.instantiate(fs.readFileSync(process.argv[2]), go.importObject).then(result => {\n  process.on(\"exit\", code => {\n    // Node.js exits if no event handler is pending\n    if (code === 0 && !go.exited) {\n      // deadlock, make Go print error and stack traces\n      go._pendingEvent = {\n        id: 0\n      };\n\n      go._resume();\n    }\n  });\n  return go.run(result.instance);\n}).catch(err => {\n  console.error(err);\n  process.exit(1);\n});","map":{"version":3,"names":["process","argv","length","console","error","exit","globalThis","require","fs","TextEncoder","TextDecoder","performance","now","sec","nsec","hrtime","crypto","getRandomValues","b","randomFillSync","go","Go","slice","env","Object","assign","TMPDIR","tmpdir","WebAssembly","instantiate","readFileSync","importObject","then","result","on","code","exited","_pendingEvent","id","_resume","run","instance","catch","err"],"sources":["/home/johan/dev/github/colonyos/dashboard/dashboard/src/colonies/crypto/wasm_exec_node.js"],"sourcesContent":["// Copyright 2021 The Go Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style\n// license that can be found in the LICENSE file.\n\n\"use strict\";\n\nif (process.argv.length < 3) {\n\tconsole.error(\"usage: go_js_wasm_exec [wasm binary] [arguments]\");\n\tprocess.exit(1);\n}\n\nglobalThis.require = require;\nglobalThis.fs = require(\"fs\");\nglobalThis.TextEncoder = require(\"util\").TextEncoder;\nglobalThis.TextDecoder = require(\"util\").TextDecoder;\n\nglobalThis.performance = {\n\tnow() {\n\t\tconst [sec, nsec] = process.hrtime();\n\t\treturn sec * 1000 + nsec / 1000000;\n\t},\n};\n\nconst crypto = require(\"crypto\");\nglobalThis.crypto = {\n\tgetRandomValues(b) {\n\t\tcrypto.randomFillSync(b);\n\t},\n};\n\nrequire(\"./wasm_exec\");\n\nconst go = new Go();\ngo.argv = process.argv.slice(2);\ngo.env = Object.assign({ TMPDIR: require(\"os\").tmpdir() }, process.env);\ngo.exit = process.exit;\nWebAssembly.instantiate(fs.readFileSync(process.argv[2]), go.importObject).then((result) => {\n\tprocess.on(\"exit\", (code) => { // Node.js exits if no event handler is pending\n\t\tif (code === 0 && !go.exited) {\n\t\t\t// deadlock, make Go print error and stack traces\n\t\t\tgo._pendingEvent = { id: 0 };\n\t\t\tgo._resume();\n\t\t}\n\t});\n\treturn go.run(result.instance);\n}).catch((err) => {\n\tconsole.error(err);\n\tprocess.exit(1);\n});\n"],"mappings":"AAAA;AACA;AACA;AAEA;;AAEA,IAAIA,OAAO,CAACC,IAAR,CAAaC,MAAb,GAAsB,CAA1B,EAA6B;EAC5BC,OAAO,CAACC,KAAR,CAAc,kDAAd;EACAJ,OAAO,CAACK,IAAR,CAAa,CAAb;AACA;;AAEDC,UAAU,CAACC,OAAX,GAAqBA,OAArB;AACAD,UAAU,CAACE,EAAX,GAAgBD,OAAO,CAAC,IAAD,CAAvB;AACAD,UAAU,CAACG,WAAX,GAAyBF,OAAO,CAAC,MAAD,CAAP,CAAgBE,WAAzC;AACAH,UAAU,CAACI,WAAX,GAAyBH,OAAO,CAAC,MAAD,CAAP,CAAgBG,WAAzC;AAEAJ,UAAU,CAACK,WAAX,GAAyB;EACxBC,GAAG,GAAG;IACL,MAAM,CAACC,GAAD,EAAMC,IAAN,IAAcd,OAAO,CAACe,MAAR,EAApB;IACA,OAAOF,GAAG,GAAG,IAAN,GAAaC,IAAI,GAAG,OAA3B;EACA;;AAJuB,CAAzB;;AAOA,MAAME,MAAM,GAAGT,OAAO,CAAC,QAAD,CAAtB;;AACAD,UAAU,CAACU,MAAX,GAAoB;EACnBC,eAAe,CAACC,CAAD,EAAI;IAClBF,MAAM,CAACG,cAAP,CAAsBD,CAAtB;EACA;;AAHkB,CAApB;;AAMAX,OAAO,CAAC,aAAD,CAAP;;AAEA,MAAMa,EAAE,GAAG,IAAIC,EAAJ,EAAX;AACAD,EAAE,CAACnB,IAAH,GAAUD,OAAO,CAACC,IAAR,CAAaqB,KAAb,CAAmB,CAAnB,CAAV;AACAF,EAAE,CAACG,GAAH,GAASC,MAAM,CAACC,MAAP,CAAc;EAAEC,MAAM,EAAEnB,OAAO,CAAC,IAAD,CAAP,CAAcoB,MAAd;AAAV,CAAd,EAAkD3B,OAAO,CAACuB,GAA1D,CAAT;AACAH,EAAE,CAACf,IAAH,GAAUL,OAAO,CAACK,IAAlB;AACAuB,WAAW,CAACC,WAAZ,CAAwBrB,EAAE,CAACsB,YAAH,CAAgB9B,OAAO,CAACC,IAAR,CAAa,CAAb,CAAhB,CAAxB,EAA0DmB,EAAE,CAACW,YAA7D,EAA2EC,IAA3E,CAAiFC,MAAD,IAAY;EAC3FjC,OAAO,CAACkC,EAAR,CAAW,MAAX,EAAoBC,IAAD,IAAU;IAAE;IAC9B,IAAIA,IAAI,KAAK,CAAT,IAAc,CAACf,EAAE,CAACgB,MAAtB,EAA8B;MAC7B;MACAhB,EAAE,CAACiB,aAAH,GAAmB;QAAEC,EAAE,EAAE;MAAN,CAAnB;;MACAlB,EAAE,CAACmB,OAAH;IACA;EACD,CAND;EAOA,OAAOnB,EAAE,CAACoB,GAAH,CAAOP,MAAM,CAACQ,QAAd,CAAP;AACA,CATD,EASGC,KATH,CASUC,GAAD,IAAS;EACjBxC,OAAO,CAACC,KAAR,CAAcuC,GAAd;EACA3C,OAAO,CAACK,IAAR,CAAa,CAAb;AACA,CAZD"},"metadata":{},"sourceType":"module"}